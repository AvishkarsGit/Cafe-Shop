<% layout('layouts/partials.ejs') %>
<body>
  <!-- cafe table with 4 chairs -->
  <section>
    <div
      class="h-[450px] bg-[url('/assets/booking_banner.png')] bg-center bg-cover !m-[10px] rounded-2xl"
    >
      <div
        class="h-full w-full bg-[rgba(0,0,0,0.7)] flex items-center justify-center rounded-2xl"
      >
        <div class="text-center !px-4 md:!px-8">
          <h1
            class="text-white text-[30px] md:text-5xl font-bold tracking-wide"
          >
            A Same Day!..
          </h1>
          <h1
            class="text-[var(--color-primary)] text-3xl md:text-5xl font-bold tracking-wide"
          >
            Table Booking is Available
          </h1>
          <p
            class="text-white max-w-[90%] md:max-w-[480px] font-medium !mt-3 text-sm md:text-base"
          >
            Welcome to
            <span class="text-[var(--color-primary)] font-semibold">
              Raje’s Cafe,</span
            >
            You can book a table for the same day or current day. We would like
            to introduce our new table booking feature. Use and experience more
            comfort with us.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- text -->
  <div class="flex items-center justify-center">
    <h1
      class="bg-[var(--color-danger)] text-[18px] font-bold uppercase text-[white] relative !px-4 !py-2 !my-4"
      style="
        clip-path: polygon(
          10% 0%,
          90% 0%,
          100% 30%,
          100% 70%,
          90% 100%,
          10% 100%,
          0% 70%,
          0% 30%
        );
      "
    >
      tables
    </h1>
  </div>

  <div class="!my-3 !px-4 sm:!px-6 md:!px-10 w-full max-w-screen-xl !mx-auto">
    <p
      class="text-center font-semibold text-sm sm:text-base md:text-lg text-red-800 bg-yellow-400 !px-3 !py-2 flex flex-col sm:flex-row items-center justify-center gap-2 rounded-md"
    >
      <i class="bx bxs-bell-ring text-xl sm:text-2xl"></i>
      <span class="text-center">
        Remember before booking!... Each table has 4 chairs. So book tables
        according to your number of guests.
      </span>
    </p>
  </div>

  <!-- tables -->
  <section class="max-w-[1000px] !mx-auto !p-3">
    <div class="flex items-center justify-center">
      <div class="grid md:grid-cols-4 sm:grid-cols-3 grid-cols-2 gap-4">
        <% if (tables && tables.length) { %> <% for (let table of tables) { %>

        <!-- check if table is booked -->
        <% if (table.isBooked) { %>
        <button
          id="table_<%= table._id  %>"
          class="border-[2px] bg-green-300 border-green-800 w-[100px] !py-2 rounded-[10px] flex items-center justify-center font-semibold text-[18px] hover:cursor-pointer tables"
          disabled
        >
          Booked
        </button>
        <% } %>

        <!-- check if table is not booked -->
        <% if (!table.isBooked) { %>
        <button
          id="<%= table._id  %>"
          class="border-[2px] border-gray-800 w-[100px] !py-2 rounded-[10px] flex items-center justify-center font-semibold text-xl hover:cursor-pointer hover:border-green-500 hover:text-green-800 tables"
        >
          <%= table.tableNumber %>
        </button>
        <% } %> <% } %> <% } %>
      </div>
    </div>
    <div class="flex items-center justify-center !my-4">
      <button
        id="booked-table"
        class="bg-gray-900 font-semibold text-xl !py-2 !px-3 rounded-[4px] text-white hover:cursor-pointer hover:bg-gray-950 hidden"
      >
        ₹ 100.00
      </button>
    </div>
  </section>

  <script>
    const tables = document.querySelectorAll(".tables");
    const bookedButton = document.getElementById("booked-table");
    const selectedTables = [];

    tables.forEach((table) => {
      table.addEventListener("click", (e) => {
        e.preventDefault();
        const id = table.id;

        const index = selectedTables.indexOf(id);
        if (index > -1) {
          // Unselect the table
          selectedTables.splice(index, 1);
          table.classList.remove("!border-blue-500", "!text-blue-800");
          table.classList.add("border-gray-800");
        } else {
          // Select the table
          selectedTables.push(id);
          table.classList.remove("border-gray-800");
          table.classList.add("!border-blue-500", "!text-blue-800");
        }

        // Toggle visibility of Book Now button
        bookedButton.classList.toggle("hidden", selectedTables.length === 0);

        console.log("Selected Tables:", selectedTables);
      });
    });

    if (bookedButton) {
      bookedButton.addEventListener("click", async (e) => {
        e.preventDefault();

        if (confirm("Are you sure to book a table ?")) {
          //yes :: call the api here for booking
          try {
            const response = await axios.post(
              "/book-table",
              { selectedTables },
              {
                headers: { "Content-Type": "application/json" },
              }
            );

            if (response.data.success) {
              showSuccessAlert(
                response.data.message,
                response.data.sub_message
              );
              setTimeout(() => {
                window.location.reload();
              }, 5000);
            }
          } catch (error) {}
        } else {
          // No
          console.log("canceled");
        }
      });
    }
  </script>
</body>
