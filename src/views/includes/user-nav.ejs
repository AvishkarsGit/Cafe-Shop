<nav class="sticky top-0 z-50">
  <div
    class="bg-white !px-[10px] h-[50px] flex items-center justify-between shadow-[0px_0px_4px_rgba(0,0,0,0.2)]"
  >
    <!-- logo div -->
    <div class="flex items-center gap-2">
      <div
        class="h-[40px] w-[40px] bg-[url('/assets/cuplogo.png')] bg-center bg-cover"
      ></div>
      <span class="font-bold text-xl text-[var(--color-primary)]"
        >Raje's Cafe</span
      >
    </div>

    <!-- nav items -->
    <div>
      <ul class="flex items-center gap-4">
        <!-- nav clicks -->
        <div
          id="nav-contents"
          class="md:flex hidden flex-col items-center justify-center w-full bg-white absolute md:relative md:flex-row md:items-center md:gap-4 md:top-0 top-[57px] left-0 right-0 transition-all duration-300 ease-in-out opacity-0 translate-y-[-10px] md:opacity-100 md:translate-y-0"
        >
          <% if(currUser) { %>
          <li class="md:!mt-0 !mt-[10px]">
            <a href="" class="font-semibold hover:text-[var(--color-primary)]"
              >My orders</a
            >
          </li>
          <li class="md:!mt-0 !mt-[10px]">
            <a
              href="/contact"
              class="font-semibold hover:text-[var(--color-primary)]"
              >Contact</a>
          </li>
          <li class="md:!my-0 !my-[10px]">
            <a
              href=""
              class="bg-[var(--color-primary)] text-white !p-[4px_10px] font-semibold hover:bg-[var(--color-success)]"
              >Book table</a
            >
          </li>
          <% } %>
          <!-- login & signup -->
        </div>

        <!-- nav-icons -->
        <% if (currUser){ %>

        <div class="flex items-center gap-4">
          <li id="menu-bar" class="md:hidden block">
            <a href="" class="text-[20px]"><i class="ri-menu-line"></i> </a>
          </li>
          <li>
            <a href="/getCart" class="text-[20px]">
              <i class="ri-shopping-cart-line"></i>
              <span
                id="cart-items-qty"
                class="text-[10px] absolute top-[8px] bg-[var(--color-primary)] right-[40px] w-[15px] h-[15px] hidden items-center justify-center rounded-[50%] text-white font-bold"
                >0</span
              >
            </a>
          </li>
          <li>
            <a href="" class="text-[20px]"><i class="ri-user-line"></i></a>
          </li>
        </div>
        <% } %>
      </ul>
      <% if (!currUser){ %>
      <button
        id="login-btn"
        class="bg-[var(--color-black-third)] text-white !p-[3px_12px] font-semibold hover:cursor-pointer hover:bg-[var(--color-primary)] md:!my-0 !my-[10px]"
      >
        Login
      </button>
      <% } %>
    </div>
  </div>
</nav>

<!-- sweet alert -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- socket.io -->
<script src="/socket.io/socket.io.js"></script>

<script>
  window.addEventListener("pageshow", function (event) {
    if (
      event.persisted ||
      (window.performance && performance.navigation.type === 2)
    ) {
      // Reload the page if it was restored from BFCache
      window.location.reload();
    }
  });

  socket = io();

  const menuBarBtn = document.getElementById("menu-bar");
  const divContents = document.getElementById("nav-contents");
  const loginBtn = document.getElementById("login-btn");
  const countSpan = document.getElementById("cart-items-qty");

  let toggle = false;

  socket.on("cart-item-count", (count) => {
    if (count > 0) {
      countSpan.innerText = count;
      countSpan.style.display = "flex";
    } else {
      countSpan.style.display = "none";
    }
  });

  fetchItemsCount(countSpan);

  if (menuBarBtn) {
    menuBarBtn.addEventListener("click", (e) => {
      e.preventDefault();

      if (!toggle) {
        divContents.style.display = "flex"; // Show the menu first
        setTimeout(() => {
          divContents.style.opacity = "1";
          divContents.style.transform = "translateY(0)";
          divContents.classList.add("shadow-lg", "shadow-black/10"); // Add shadow
        }, 10); // Small delay to allow CSS transition

        toggle = true;
      } else {
        divContents.style.opacity = "0";
        divContents.style.transform = "translateY(-10px)";
        divContents.classList.remove("shadow-lg", "shadow-black/10"); // Remove shadow

        setTimeout(() => {
          divContents.style.display = "none"; // Hide after animation completes
        }, 300); // Wait for the animation duration (300ms)

        toggle = false;
      }
    });
  }

  if (loginBtn) {
    loginBtn.addEventListener("click", (e) => {
      e.preventDefault();
      window.location.replace("/auth/login");
    });
  }

  async function fetchItemsCount(countSpan) {
    try {
      const response = await axios.get("/cart/getItemsCount");
      if (response.data.success) {
        countSpan.innerText = response.data.count;
        countSpan.style.display = "flex";
      } else {
        countSpan.style.display = "none";
      }
    } catch (error) {
      showErrorAlert(error.response.data.message);
    }
  }
</script>
